/**
 * PROG2004 Assessment 1 - Simple Health Service Appointment System
 * Main class that demonstrates the appointment system functionality
 * This class contains the main method and manages the appointment collection
 *
 * @author Ziheng Huo
 * @version 1.0
 */
import java.util.ArrayList;
import java.util.Iterator;

public class AssignmentOne {

    // ArrayList to store all appointments - using final for immutability
    private static final ArrayList<Appointment> appointments = new ArrayList<>();

    /**
     * Main method that demonstrates all parts of the assignment
     * Part 3: Creating and using health professional objects
     * Part 5: Managing appointment collection with ArrayList
     *
     * @param args command line arguments (not used in this application)
     */
    static void main(String[] args) {

        // Part 3 – Using classes and objects
        // Demonstrates creating objects and inheritance hierarchy
        System.out.println("// Part 3 – Using classes and objects");

        // Create three General Practitioner objects with different attributes
        GeneralPractitioner gp1 = new GeneralPractitioner(101, "Dr. Smith", "Family Medicine", true, 25);
        GeneralPractitioner gp2 = new GeneralPractitioner(102, "Dr. Johnson", "Primary Care", true, 30);
        GeneralPractitioner gp3 = new GeneralPractitioner(103, "Dr. Brown", "General Practice", false, 15);

        // Create two Specialist objects with specialized fields
        Specialist specialist1 = new Specialist(201, "Dr. Wilson", "Cardiology",
                "Heart Surgery", 15, true);
        Specialist specialist2 = new Specialist(202, "Dr. Davis", "Radiology",
                "MRI Specialist", 10, true);

        // Print details of all health professionals to demonstrate inheritance
        System.out.println("=== Displaying Health Professional Details ===");
        gp1.printProfessionalDetails();
        gp2.printProfessionalDetails();
        gp3.printProfessionalDetails();
        specialist1.printProfessionalDetails();
        specialist2.printProfessionalDetails();

        System.out.println("---");

        // Part 5 – Collection of appointments
        // Demonstrates ArrayList operations for appointment management
        System.out.println("// Part 5 – Collection of appointments");

        // Create appointments with different health professionals
        // Demonstrates polymorphism - same method works with different types
        createAppointment("John Doe", "0412345678", "09:00", gp1);
        createAppointment("Jane Smith", "0498765432", "10:30", gp2);
        createAppointment("Bob Wilson", "0432145698", "14:00", specialist1);
        createAppointment("Alice Brown", "0456789123", "11:15", specialist2);

        // Display all current appointments
        System.out.println("\n=== Current Appointments ===");
        printExistingAppointments();

        // Cancel an appointment to demonstrate collection modification
        System.out.println("\n=== Cancelling an Appointment ===");
        cancelBooking("0498765432");

        // Display updated appointment list
        System.out.println("\n=== Updated Appointments After Cancellation ===");
        printExistingAppointments();

        System.out.println("---");
    }

    /**
     * Creates a new appointment and adds it to the appointments ArrayList
     * Demonstrates polymorphism by accepting any HealthProfessional subclass
     *
     * @param patientName the name of the patient making the appointment
     * @param mobilePhone the patient's mobile phone number for identification
     * @param timeSlot the preferred time slot for the appointment
     * @param doctor the health professional (GP or Specialist) for the appointment
     */
    public static void createAppointment(String patientName, String mobilePhone,
                                         String timeSlot, HealthProfessional doctor) {
        // Validate all required information is provided
        if (patientName == null || patientName.trim().isEmpty() ||
                mobilePhone == null || mobilePhone.trim().isEmpty() ||
                timeSlot == null || timeSlot.trim().isEmpty() ||
                doctor == null) {
            System.out.println("Error: All appointment details are required. Appointment not created.");
            return;
        }

        // Create new appointment object and add to collection
        Appointment newAppointment = new Appointment(patientName, mobilePhone, timeSlot, doctor);
        appointments.add(newAppointment);
        System.out.println("Appointment created successfully for " + patientName + " at " + timeSlot);
    }

    /**
     * Displays all existing appointments in the ArrayList
     * Shows how to iterate through and access elements in the collection
     * Handles empty collection case appropriately
     */
    public static void printExistingAppointments() {
        // Check if there are any appointments
        if (appointments.isEmpty()) {
            System.out.println("No existing appointments.");
            return;
        }

        // Iterate through all appointments and display their details
        System.out.println("=== Existing Appointments ===");
        for (int i = 0; i < appointments.size(); i++) {
            System.out.println("Appointment #" + (i + 1) + ":");
            appointments.get(i).printAppointmentDetails();
        }
    }

    /**
     * Cancels a booking by searching for the patient's mobile phone
     * Demonstrates safe removal from ArrayList using Iterator
     *
     * @param mobilePhone the mobile phone number used to identify the appointment to cancel
     */
    public static void cancelBooking(String mobilePhone) {
        // Validate mobile phone parameter
        if (mobilePhone == null || mobilePhone.trim().isEmpty()) {
            System.out.println("Error: Mobile phone number is required to cancel booking.");
            return;
        }

        // Use Iterator for safe removal during iteration
        Iterator<Appointment> iterator = appointments.iterator();
        boolean found = false;

        // Search for appointment with matching mobile phone
        while (iterator.hasNext()) {
            Appointment appointment = iterator.next();
            if (appointment.getMobilePhone().equals(mobilePhone)) {
                iterator.remove();
                System.out.println("Appointment for mobile " + mobilePhone + " has been cancelled.");
                found = true;
                break;
            }
        }

        // Handle case where no matching appointment was found
        if (!found) {
            System.out.println("Error: No appointment found with mobile phone: " + mobilePhone);
        }
    }
}
